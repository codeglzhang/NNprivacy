package ai.protect.privacy.network;

import ai.protect.privacy.network.layercomputer.CovUtils;
import ai.protect.privacy.network.node.ReLu;
import ai.protect.privacy.network.node.SimpleOptions;
import com.google.gson.Gson;
import org.junit.Test;

import java.util.ArrayList;
import java.util.List;

public class CovTest {
    @Test
    public void testCov(){
        Gson gson =new Gson();
        String d = "[[0.04713576, 0.04713576, 0.04713576, 0.04713576, 0.04713576, 0.04713576, 0.04713576, 0.04713576, 0.04713576, 0.04713576, 0.04713576, 0.04713576], [0.04713576, 0.08081096, 0.04713576, 0.04713576, 0.04713576, 0.04713576, 0.04713576, 0.04713576, 0.04713576, 0.04713576, 0.04713576, 0.04713576], [0.04713576, 0.11861543, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.00453615, 0.04713576], [0.04713576, 0.17465317, 0.6939147, 0.952982, 0.65855956, 0.32939157, 0.15276363, 0.15626475, 0.0, 0.0, 0.01525407, 0.04713576], [0.04713576, 0.38526958, 0.83643174, 1.1516987, 1.1596062, 1.2397453, 1.2083769, 1.2903122, 0.78265226, 0.47843546, 0.52126753, 0.04713576], [0.04713576, 0.04713576, 0.04713576, 0.05228981, 0.13453373, 0.20555857, 0.26572773, 0.0667979, 0.0, 0.616451, 0.45422673, 0.04713576], [0.04713576, 0.04713576, 0.04713576, 0.04713576, 0.04713576, 0.09577151, 0.08789857, 0.0, 0.58502036, 0.67345494, 0.1436028, 0.04713576], [0.04713576, 0.04713576, 0.04713576, 0.04713576, 0.05475277, 0.10329635, 0.0, 0.0, 0.61936384, 0.42866915, 0.04713576, 0.04713576], [0.04713576, 0.04713576, 0.04713576, 0.04713576, 0.12190296, 0.0, 0.0, 0.6140608, 0.5989391, 0.09311058, 0.04713576, 0.04713576], [0.04713576, 0.04713576, 0.04713576, 0.09398945, 0.10131708, 0.0, 0.51390976, 0.7528663, 0.39373863, 0.04713576, 0.04713576, 0.04713576], [0.04713576, 0.04713576, 0.04713576, 0.08292191, 0.0, 0.0, 0.5083675, 0.572109, 0.07487919, 0.04713576, 0.04713576, 0.04713576], [0.04713576, 0.04713576, 0.04713576, 0.06448761, 0.262152, 0.6259355, 0.7267208, 0.15493613, 0.04713576, 0.04713576, 0.04713576, 0.04713576], [0.07518563, 0.07518563, 0.07518563, 0.07518563, 0.07518563, 0.07518563, 0.07518563, 0.07518563, 0.07518563, 0.07518563, 0.07518563, 0.07518563], [0.07518563, 0.26231465, 0.15396348, 0.07518563, 0.07518563, 0.08323298, 0.07518563, 0.07518563, 0.07518563, 0.07518563, 0.07518563, 0.07518563], [0.07518563, 0.42459688, 0.12808779, 0.0, 0.0, 0.03091509, 0.0, 0.0, 0.0, 0.0, 0.14222988, 0.07518563], [0.07518563, 0.23839545, 0.0, 0.0, 0.0, 0.0, 0.0, 0.04024924, 0.0, 0.0, 0.19288868, 0.07518563], [0.07518563, 0.11664307, 0.00961154, 0.0, 0.0, 0.0, 0.0, 0.20680001, 0.0, 0.0, 0.20284158, 0.07518563], [0.07518563, 0.07518563, 0.07518563, 0.07842901, 0.08241153, 0.07518563, 0.55800474, 0.44390506, 0.0, 0.11285197, 0.20534277, 0.07518563], [0.07518563, 0.07518563, 0.07518563, 0.07518563, 0.07518563, 0.21487713, 0.57533634, 0.0, 0.0, 0.19777143, 0.11234245, 0.07518563], [0.07518563, 0.07518563, 0.07518563, 0.07518563, 0.09522958, 0.5266658, 0.49212807, 0.0, 0.17853162, 0.18778718, 0.07518563, 0.07518563], [0.07518563, 0.07518563, 0.07518563, 0.07518563, 0.5006242, 0.51763463, 0.0, 0.0, 0.18772635, 0.08269466, 0.07518563, 0.07518563], [0.07518563, 0.07518563, 0.07518563, 0.23880693, 0.57400304, 0.1515063, 0.0, 0.1484631, 0.1784884, 0.07518563, 0.07518563, 0.07518563], [0.07518563, 0.07518563, 0.07518563, 0.55495334, 0.51774657, 0.0, 0.13735154, 0.18418613, 0.07971695, 0.07518563, 0.07518563, 0.07518563], [0.07518563, 0.07518563, 0.07518563, 0.60068613, 0.20312706, 0.0, 0.24415356, 0.14609292, 0.07518563, 0.07518563, 0.07518563, 0.07518563], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0253133, 0.14154945, 0.20574541, 0.13666959, 0.03850597, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.09589181, 0.64174086, 1.1632369, 1.1083317, 0.9186353, 0.87681514, 0.86935544, 0.9221275, 0.78903913, 0.33742198, 0.0], [0.0, 0.50398713, 0.7729932, 1.0246811, 1.0611238, 1.0478675, 1.1071137, 1.1222862, 1.4324818, 1.3128462, 0.7889178, 0.0], [0.0, 0.46962985, 0.5927564, 1.0069848, 1.1145712, 1.1944039, 1.2008168, 1.2104751, 1.7944643, 1.5846059, 0.8215369, 0.0], [0.0, 0.0, 0.0, 0.0152866, 0.06904838, 0.15843485, 0.12195388, 1.2229307, 1.5427, 1.305786, 0.4904653, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.4763541, 1.4703176, 1.382766, 0.9700947, 0.09152248, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.02757241, 1.2324667, 1.4884751, 1.1988163, 0.39180395, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.7933265, 1.6437931, 1.3820755, 0.8681223, 0.05264181, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.27435216, 1.6166592, 1.6690363, 1.0744104, 0.349498, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 1.1480218, 1.8222708, 1.3874774, 0.6722166, 0.03170894, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.22695367, 1.4624766, 1.6401005, 1.4751676, 0.19121234, 0.0, 0.0, 0.0, 0.0], [0.0488105, 0.0488105, 0.0488105, 0.0488105, 0.0488105, 0.0488105, 0.0488105, 0.0488105, 0.0488105, 0.0488105, 0.0488105, 0.0488105], [0.0488105, 0.2098118, 0.18828365, 0.22460441, 0.18495771, 0.09531981, 0.0488105, 0.0488105, 0.0488105, 0.0488105, 0.0488105, 0.0488105], [0.0488105, 0.43601912, 0.42012638, 0.41481045, 0.28709477, 0.3756465, 0.39762244, 0.4109398, 0.40226814, 0.21700218, 0.16155593, 0.0488105], [0.0488105, 0.29982126, 0.18141203, 0.0, 0.0, 0.0, 0.0, 0.03950674, 0.04251309, 0.0, 0.0, 0.0488105], [0.0488105, 0.13856487, 0.07024829, 0.0, 0.01077257, 0.0, 0.0, 0.40987274, 0.1812817, 0.0, 0.02458862, 0.0488105], [0.0488105, 0.0488105, 0.0488105, 0.0488105, 0.05613091, 0.0488105, 0.45187405, 0.63105905, 0.204024, 0.0, 0.04488013, 0.0488105], [0.0488105, 0.0488105, 0.0488105, 0.0488105, 0.0488105, 0.16514435, 0.6058657, 0.45980075, 0.0, 0.0, 0.0488105, 0.0488105], [0.0488105, 0.0488105, 0.0488105, 0.0488105, 0.06600556, 0.44637677, 0.5945513, 0.18490376, 0.0, 0.04771873, 0.0488105, 0.0488105], [0.0488105, 0.0488105, 0.0488105, 0.0488105, 0.340133, 0.604551, 0.48017547, 0.0, 0.02039577, 0.0488105, 0.0488105, 0.0488105], [0.0488105, 0.0488105, 0.0488105, 0.17711003, 0.6837487, 0.54695594, 0.04608418, 0.0, 0.0488105, 0.0488105, 0.0488105, 0.0488105], [0.0488105, 0.0488105, 0.0488105, 0.45879048, 0.6843246, 0.34626967, 0.0, 0.03219595, 0.0488105, 0.0488105, 0.0488105, 0.0488105], [0.0488105, 0.0488105, 0.0488105, 0.593564, 0.6183425, 0.0, 0.0, 0.0488105, 0.0488105, 0.0488105, 0.0488105, 0.0488105], [0.04949562, 0.04949562, 0.04949562, 0.04949562, 0.04949562, 0.04949562, 0.04949562, 0.04949562, 0.04949562, 0.04949562, 0.04949562, 0.04949562], [0.04949562, 0.05754092, 0.24598572, 0.34158605, 0.24150391, 0.09044012, 0.04949562, 0.04949562, 0.04949562, 0.04949562, 0.04949562, 0.04949562], [0.04949562, 0.33067745, 0.8329134, 1.0985177, 1.106389, 1.0468733, 1.0122378, 1.024031, 0.99531215, 0.87261915, 0.36998856, 0.04949562], [0.04949562, 0.33741027, 0.51745033, 0.62632406, 0.8828981, 1.1018369, 1.1539307, 1.1885142, 1.1885569, 1.1119856, 0.5206746, 0.04949562], [0.04949562, 0.01144198, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.02883889, 0.02606298, 0.04949562], [0.04949562, 0.04949562, 0.04949562, 0.04949562, 0.04949562, 0.04949562, 0.28121954, 0.7450592, 0.37430316, 0.0, 0.03636972, 0.04949562], [0.04949562, 0.04949562, 0.04949562, 0.04949562, 0.04949562, 0.04949562, 0.53541404, 0.65253943, 0.19676544, 0.0, 0.04949562, 0.04949562], [0.04949562, 0.04949562, 0.04949562, 0.04949562, 0.04949562, 0.3452499, 0.7055512, 0.34381354, 0.0, 0.04584954, 0.04949562, 0.04949562], [0.04949562, 0.04949562, 0.04949562, 0.04949562, 0.10935108, 0.8255239, 0.8867937, 0.2752878, 0.0, 0.04949562, 0.04949562, 0.04949562], [0.04949562, 0.04949562, 0.04949562, 0.04949562, 0.5898774, 0.8278227, 0.35341245, 0.0, 0.04949562, 0.04949562, 0.04949562, 0.04949562], [0.04949562, 0.04949562, 0.04949562, 0.2755227, 0.85568494, 0.7220409, 0.0, 0.0, 0.04949562, 0.04949562, 0.04949562, 0.04949562], [0.04949562, 0.04949562, 0.04949562, 0.37071806, 0.6755875, 0.3630876, 0.0, 0.04949562, 0.04949562, 0.04949562, 0.04949562, 0.04949562], [0.00725915, 0.00725915, 0.00725915, 0.00725915, 0.00725915, 0.00725915, 0.00725915, 0.00725915, 0.00725915, 0.00725915, 0.00725915, 0.00725915], [0.00725915, 0.00725915, 0.00725915, 0.11924762, 0.13965116, 0.04346858, 0.00725915, 0.00725915, 0.00725915, 0.00725915, 0.00725915, 0.00725915], [0.00725915, 0.05714237, 0.46117336, 0.49491727, 0.31900838, 0.26421925, 0.2546193, 0.2810426, 0.31580055, 0.39815953, 0.18555443, 0.00725915], [0.00725915, 0.30351385, 0.6574162, 0.69135714, 0.74431807, 0.6507943, 0.6446449, 0.6918443, 0.8230522, 0.90578073, 0.31237534, 0.00725915], [0.00725915, 0.4349568, 0.7640209, 0.7301098, 0.68608105, 0.7319668, 0.8044091, 0.65536046, 1.3029914, 1.0610031, 0.22632824, 0.00725915], [0.00725915, 0.00725915, 0.00725915, 0.02371173, 0.0847829, 0.16245158, 0.08934111, 0.8251891, 1.2817098, 0.849836, 0.08769797, 0.00725915], [0.00725915, 0.00725915, 0.00725915, 0.00725915, 0.00725915, 0.00725915, 0.0857909, 1.2797966, 1.2484398, 0.33442903, 0.00725915, 0.00725915], [0.00725915, 0.00725915, 0.00725915, 0.00725915, 0.00725915, 0.0, 0.90499055, 1.257814, 0.7534934, 0.04108311, 0.00725915, 0.00725915], [0.00725915, 0.00725915, 0.00725915, 0.00725915, 0.00441043, 0.3369154, 1.2833576, 1.1628425, 0.31112924, 0.00725915, 0.00725915, 0.00725915], [0.00725915, 0.00725915, 0.00725915, 0.00725915, 0.0, 1.1784701, 1.2903776, 0.6757845, 0.02819636, 0.00725915, 0.00725915, 0.00725915], [0.00725915, 0.00725915, 0.00725915, 0.0, 0.59978056, 1.4083763, 1.1314423, 0.2111613, 0.00725915, 0.00725915, 0.00725915, 0.00725915], [0.00725915, 0.00725915, 0.00725915, 0.24400114, 1.1488166, 1.387751, 0.5817586, 0.0216842, 0.00725915, 0.00725915, 0.00725915, 0.00725915]]";
        String ww = "[0.09593468,0.14744093,0.1024109,0.07526571,-0.05617983,0.0437336,0.09860089,-0.13013023,0.06104482,0.02745569,0.02898063,-0.17401944,0.03699337,-0.03701571,0.07062826,0.00156179,0.05661833,0.04267788,0.03548984,0.08291578,0.05701692,0.04015957,0.03101074,-0.01246418,0.09286147,-0.06872078,-0.03076607,-0.0779483,0.04806482,-0.11457076,-0.00533862,0.00163929,-0.09262055,-0.04674185,-0.058013,0.11362967,0.00642363,-0.14722414,-0.15630051,-0.18037072,0.03856806,-0.14025258,-0.23174906,-0.17483181,-0.24492733,0.05956089,-0.02017916,-0.09958865,-0.03892815,0.0298136,-0.01076487,-0.11667466,-0.08979885,0.00567627,-0.00505643,-0.08026949,-0.14705308,-0.02112735,-0.04066879,-0.01865864,-0.03175957,0.13975045,0.06829233,-0.00789585,0.08767807,0.12578483,0.01748366,0.09319673,0.07751855,0.09572592,0.06376154,-0.09513336,0.01861863,-0.05316107,0.05801538,-0.05703825,-0.01679311,0.02875944,0.14425343,0.10014683,-0.01279216,0.10564429,0.14576955,-0.01039652,-0.01330576,-0.06769439,-0.05958442,-0.12155773,-0.04174795,-0.08546674,0.03844293,-0.02505287,-0.20712551,-0.00324736,-0.12183327,-0.06545088,-0.10305722,-0.1731482,-0.162158,0.09523191,-0.04090303,-0.03922617,-0.07662996,0.07662372,0.12332258,0.01628977,0.08840742,0.10492437,0.1668765,-0.00832263,0.17171538,0.01854463,0.10872021,-0.01015043,0.12707512,-0.06377053,0.04707834,-0.00053187,0.00377325,0.15936811,-0.13502958,-0.07197155,-0.01711378,0.07125288,0.1152765,-0.00819017,0.05944738,0.03616269,-0.1098704,-0.10271493,-0.11043927,-0.05277648,0.06358675,0.08879029,0.12999755,0.10412987,-0.01068081,-0.00809234,-0.03579879,0.06638505,0.00194788,0.04958196,0.04732509,-0.08098535,-0.04479963,0.13140272,0.00093654,-0.08710741,0.06745147,-0.09378529]";
        Double[][] image=gson.fromJson(d,Double[][].class);
        Double[] weight=gson.fromJson(ww,Double[].class);
        int blockNumber=64;
        int blockRowNum=8;
        int blockColNum=8;
        int step = 1;
        double bias = 0.01195575;


        List pre = new ArrayList();
        for(int i =0;i<blockNumber;i++) {
            List<Double> block = new ArrayList();
            CovUtils.get2dBlock(image, block, (i/blockColNum)*step, (i%blockColNum)*step, 5, 5);
            Double result = bias;
            int j = 0;
            for (Double x:block){
                result+=x*weight[j];
                j++;
            }
            ReLu reLu =new ReLu();

            pre.add(reLu.compute(result,new SimpleOptions()));
        }

        System.out.println(pre);
    }


}
